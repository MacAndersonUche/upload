(()=>{var e={};e.id=994,e.ids=[994],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4787:(e,r,n)=>{"use strict";n.r(r),n.d(r,{GlobalError:()=>i.a,__next_app__:()=>p,pages:()=>u,routeModule:()=>c,tree:()=>d});var t=n(260),o=n(8203),a=n(5155),i=n.n(a),s=n(7292),l={};for(let e in s)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);n.d(r,l);let d=["",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,218)),"C:\\Users\\macan\\Downloads\\takehome-large-upload-main\\app\\upload\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(n.bind(n,9611)),"C:\\Users\\macan\\Downloads\\takehome-large-upload-main\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,1485,23)),"next/dist/client/components/unauthorized-error"]}],u=["C:\\Users\\macan\\Downloads\\takehome-large-upload-main\\app\\upload\\page.tsx"],p={require:n,loadChunk:()=>Promise.resolve()},c=new t.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/upload/page",pathname:"/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2261:(e,r,n)=>{Promise.resolve().then(n.bind(n,2504))},6181:(e,r,n)=>{Promise.resolve().then(n.bind(n,1003))},3469:(e,r,n)=>{Promise.resolve().then(n.t.bind(n,3219,23)),Promise.resolve().then(n.t.bind(n,4863,23)),Promise.resolve().then(n.t.bind(n,5155,23)),Promise.resolve().then(n.t.bind(n,802,23)),Promise.resolve().then(n.t.bind(n,9350,23)),Promise.resolve().then(n.t.bind(n,8530,23)),Promise.resolve().then(n.t.bind(n,8921,23))},3613:(e,r,n)=>{Promise.resolve().then(n.t.bind(n,6959,23)),Promise.resolve().then(n.t.bind(n,3875,23)),Promise.resolve().then(n.t.bind(n,8903,23)),Promise.resolve().then(n.t.bind(n,7174,23)),Promise.resolve().then(n.t.bind(n,4178,23)),Promise.resolve().then(n.t.bind(n,7190,23)),Promise.resolve().then(n.t.bind(n,1365,23))},6487:()=>{},8335:()=>{},1003:(e,r,n)=>{"use strict";n.d(r,{default:()=>d});var t=n(5512),o=n(8686),a=n(8009);function i(e,r){switch(r.type){case"START_UPLOAD":return{phase:"uploading",sessionId:r.sessionId,totalChunks:r.totalChunks,uploadedChunkCount:0};case"CHUNK_OK":if("uploading"!==e.phase)return e;return{...e,uploadedChunkCount:r.uploadedChunkCount};case"START_FINALIZE":if("uploading"!==e.phase)return e;return{phase:"finalizing",sessionId:e.sessionId,totalChunks:e.totalChunks};case"DONE":if("finalizing"!==e.phase)return e;return{phase:"done",sessionId:e.sessionId};case"FAIL":return{phase:"error",message:r.message};case"CANCEL":return{phase:"canceled"};case"RESET":return{phase:"idle"};default:return e}}function s(e){return(e.name||"").toLowerCase().endsWith(".csv")||"text/csv"===e.type||"application/csv"===e.type?0===e.size?"This file is empty. Please choose a file with data.":e.size>0x6400000?"File is too large. Maximum size is 100 MB. Please choose a smaller file or split your data.":null:"Please choose a CSV file (e.g. data.csv)."}let l=["Select","Validate","Upload","Finalize","Ready"];function d(){let e=(0,o.useRouter)(),[r,n]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),{status:p,progress:c,error:h,start:f,cancel:g,reset:m,sessionId:x,totalChunks:y,uploadedChunkCount:b}=function(){let[e,r]=(0,a.useReducer)(i,{phase:"idle"}),n=(0,a.useRef)(null),t=(0,a.useRef)(!1),o=(0,a.useCallback)(()=>{n.current?.abort(),n.current=null,r({type:"RESET"})},[]),s=(0,a.useCallback)(()=>{n.current?.abort(),n.current=null,r({type:"CANCEL"})},[]),l=(0,a.useCallback)(async e=>{if(t.current)return;t.current=!0;let o=new AbortController;n.current=o;let a=o.signal,i=()=>a.aborted;try{let s=await fetch("/api/upload/init",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({filename:e.name,size:e.size}),signal:a});if(!s.ok)throw Error(`init failed (${s.status})`);let l=(await s.json()).sessionId;localStorage.setItem("lastSessionId",l);let d=Math.ceil(e.size/1048576);r({type:"START_UPLOAD",sessionId:l,totalChunks:d});for(let s=0;s<d;s++){if(i())return;let u=null;for(let r=1;r<=3;r++){if(i())return;try{let r=1048576*s,n=Math.min(r+1048576,e.size),t=e.slice(r,n),o=await t.arrayBuffer(),i=await fetch("/api/upload/chunk",{method:"POST",headers:{"content-type":"application/octet-stream","x-session-id":l,"x-chunk-index":String(s),"x-total-chunks":String(d)},body:o,signal:a});if(!i.ok)throw Error(`chunk ${s} failed (${i.status})`);u=null;break}catch(e){if(u=e instanceof Error?e:Error(String(e)),e?.name==="AbortError")return;r<3&&await new Promise(e=>setTimeout(e,1e3))}}if(u){let e=u.message||`Part ${s+1} of ${d} failed after 3 tries.`;t.current=!1,n.current===o&&(n.current=null),r({type:"FAIL",message:e});return}if(i())return;r({type:"CHUNK_OK",uploadedChunkCount:s+1})}if(i())return;r({type:"START_FINALIZE"});let u=await fetch("/api/upload/finalize",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({sessionId:l}),signal:a});if(!u.ok)throw Error(`finalize failed (${u.status})`);if(i())return;r({type:"DONE"})}catch(e){if(e?.name==="AbortError")return;r({type:"FAIL",message:e instanceof Error?e.message:"Upload failed"})}finally{t.current=!1,n.current===o&&(n.current=null)}},[]),d="idle"===e.phase?"idle":"uploading"===e.phase?"uploading":"finalizing"===e.phase?"finalizing":"done"===e.phase?"done":"error"===e.phase?"error":"canceled",u="uploading"===e.phase?e.totalChunks>0?e.uploadedChunkCount/e.totalChunks:0:"finalizing"===e.phase?1:0,p="error"===e.phase?e.message:null,c="uploading"===e.phase||"finalizing"===e.phase||"done"===e.phase?e.sessionId:null,h="uploading"===e.phase||"finalizing"===e.phase?e.totalChunks:0,f="uploading"===e.phase?e.uploadedChunkCount:"finalizing"===e.phase?e.totalChunks:0;return{state:e,status:d,progress:u,error:p,start:l,cancel:s,reset:o,sessionId:c,totalChunks:h,uploadedChunkCount:f}}(),v=!!r&&("idle"===p||"error"===p||"canceled"===p||"done"===p),C="uploading"===p||"finalizing"===p,k=(0,a.useMemo)(()=>r?{name:r.name,size:function(e){let r=["B","KB","MB","GB"],n=0,t=e;for(;t>=1024&&n<r.length-1;)t/=1024,n++;return`${t.toFixed(0===n?0:1)} ${r[n]}`}(r.size)}:null,[r]),P="done"===p?4:"finalizing"===p?3:"uploading"===p?2:r&&("idle"===p||"error"===p||"canceled"===p)?1:0,w="uploading"===p&&y>0?`Uploading your file… part ${b} of ${y}`:"finalizing"===p?"Almost done — saving your file…":"done"===p?"Your file is ready.":r&&!d&&"error"!==p?"File looks good. Click Start upload when ready.":r&&d?d:"error"===p&&h?h.includes("init failed")?"We couldn't start the upload. Please try again.":h.includes("chunk")&&h.includes("failed")?"Part of the file didn't upload. You can try again.":h.includes("finalize")?"Upload didn't finish saving. Please try again.":h.includes("fetch")||h.includes("network")||h.includes("Failed to fetch")?"Connection problem. Check your internet and try again.":"Something went wrong. Please try again.":"canceled"===p?"Upload was cancelled.":"Choose a CSV file (about 10–100 MB is fine).";return(0,t.jsxs)("div",{style:{border:"1px solid #e5e5e5",borderRadius:12,padding:24,maxWidth:520},children:[(0,t.jsx)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,fontSize:12,color:"#666"},children:l.map((e,r)=>(0,t.jsx)("span",{style:{fontWeight:r===P?600:400,color:r<=P?"#111":"#999"},children:e},e))}),(0,t.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsx)("input",{type:"file",accept:".csv,text/csv",disabled:C,onChange:e=>{let r=e.target.files?.[0]??null;n(r),u(null),r&&u(s(r))},"aria-label":"Choose CSV file"}),k&&(0,t.jsxs)("span",{style:{color:"#444"},children:[k.name," \xb7 ",k.size]})]}),(0,t.jsx)("p",{style:{marginTop:16,marginBottom:0,fontSize:14,color:"error"===p?"#b00020":"#333",minHeight:20},children:w}),("uploading"===p||"finalizing"===p)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{marginTop:12,background:"#eee",borderRadius:999,height:8,overflow:"hidden"},children:(0,t.jsx)("div",{style:{width:`${Math.round(100*c)}%`,height:"100%",background:"#111",transition:"width 0.2s ease"}})}),(0,t.jsx)("p",{style:{marginTop:6,marginBottom:0,fontSize:12,color:"#666"},children:"finalizing"===p?"Saving…":y>0?`${b} of ${y} parts uploaded`:null})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:20},children:[(0,t.jsx)("button",{onClick:()=>{if(!r)return;let e=s(r);if(e){u(e);return}u(null),f(r)},disabled:!v||!!d||C,style:{padding:"10px 16px",borderRadius:8,fontWeight:600,background:"#111",color:"#fff",border:"none",cursor:!v||d||C?"not-allowed":"pointer"},children:"Start upload"}),C&&(0,t.jsx)("button",{onClick:()=>g(),style:{padding:"10px 16px",borderRadius:8,background:"#fff",color:"#333",border:"1px solid #ccc",cursor:"pointer"},children:"Cancel"}),("error"===p||"canceled"===p||"done"===p)&&(0,t.jsx)("button",{onClick:()=>{m(),n(null),u(null)},style:{padding:"10px 16px",borderRadius:8,background:"#fff",color:"#333",border:"1px solid #ccc",cursor:"pointer"},children:"done"===p?"Upload another file":"Start over"}),"done"===p&&!!x&&(0,t.jsx)("button",{onClick:()=>e.push(`/preview?sessionId=${encodeURIComponent(x??"")}`),style:{padding:"10px 16px",borderRadius:8,fontWeight:600,background:"#0d6efd",color:"#fff",border:"none",cursor:"pointer"},children:"View your data"})]}),"error"===p&&h&&(0,t.jsxs)("div",{style:{marginTop:16,padding:12,background:"#fef2f2",borderRadius:8,fontSize:13,color:"#b00020"},children:[(0,t.jsx)("strong",{children:"What you can do:"}),' Use "Start upload" again to retry, or choose a different file and try again.']})]})}},9611:(e,r,n)=>{"use strict";n.r(r),n.d(r,{default:()=>o});var t=n(2740);function o({children:e}){return(0,t.jsx)("html",{lang:"en",children:(0,t.jsx)("body",{style:{fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, sans-serif",margin:0},children:(0,t.jsxs)("div",{style:{maxWidth:1100,margin:"0 auto",padding:24},children:[(0,t.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:18},children:[(0,t.jsx)("div",{style:{fontWeight:700},children:"Large Upload Take-home"}),(0,t.jsx)("div",{style:{color:"#666"},children:"Chunked uploads + data preview"})]}),e]})})})}},218:(e,r,n)=>{"use strict";n.r(r),n.d(r,{default:()=>a});var t=n(2740),o=n(2504);function a(){return(0,t.jsxs)("main",{children:[(0,t.jsx)("h1",{style:{margin:"8px 0 4px"},children:"Upload"}),(0,t.jsx)("p",{style:{marginTop:0,color:"#555"},children:"Upload a CSV file (up to 100 MB). We’ll guide you through each step."}),(0,t.jsx)(o.default,{})]})}},2504:(e,r,n)=>{"use strict";n.d(r,{default:()=>t});let t=(0,n(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\macan\\\\Downloads\\\\takehome-large-upload-main\\\\components\\\\UploadWizard.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\macan\\Downloads\\takehome-large-upload-main\\components\\UploadWizard.tsx","default")}};var r=require("../../webpack-runtime.js");r.C(e);var n=e=>r(r.s=e),t=r.X(0,[638,403],()=>n(4787));module.exports=t})();